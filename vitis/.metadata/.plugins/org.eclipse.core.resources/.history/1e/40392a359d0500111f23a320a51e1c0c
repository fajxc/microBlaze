#include "xil_io.h"
#include "xil_printf.h"
#include "sleep.h"

#define BASE 0x44A00000

#define REG0 (BASE + 0x00)
#define REG3 (BASE + 0x0C)

int main()
{
    xil_printf("\r\n=== MEM LOAD (b1[0]) TEST ===\r\n");

    // Ensure start low
    Xil_Out32(REG0, 0);
    usleep(1000);

    // Start
    Xil_Out32(REG0, 1);

    // Poll done
    while ((Xil_In32(REG3) & 0x1) == 0) {}

    u32 r = Xil_In32(REG3);
    u32 pred = (r >> 4) & 0xF;

    xil_printf("REG3=0x%08lx pred=%lu\r\n", (unsigned long)r, (unsigned long)pred);
    xil_printf("Expected pred = low nibble of FIRST LINE in b1.mem (b1[0][3:0])\r\n");

    // Re-arm
    Xil_Out32(REG0, 0);

    while (1) {}
}
